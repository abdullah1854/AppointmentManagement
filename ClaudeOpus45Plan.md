# Appointment Management - Implementation Plan
**Generated by Claude Opus 4.5**

## Overview
Build an Appointment Scheduling feature with:
- **Backend**: Python FastAPI with mock data (simulating Lambda/AppSync)
- **Frontend**: React + Tailwind calling the API via fetch

## Project Structure
```
Appointment Management/
├── backend/
│   ├── appointment_service.py   # FastAPI app with CRUD endpoints
│   └── requirements.txt         # fastapi, uvicorn
├── frontend/
│   ├── src/
│   │   └── EMR_Frontend__Assignment.jsx  # Main component
│   ├── package.json
│   └── index.html
└── README.md                    # GraphQL shape + consistency notes
```

---

## Phase 1: Backend (FastAPI)

### File: `backend/appointment_service.py`

**Mock Data** (10+ appointments):
```python
appointments = [
    {"id": "1", "patientName": "John Doe", "date": "2024-01-15", "time": "09:00",
     "duration": 30, "doctorName": "Dr. Smith", "status": "Confirmed", "mode": "In-Person"},
    {"id": "2", "patientName": "Jane Smith", "date": "2024-01-15", "time": "10:00",
     "duration": 45, "doctorName": "Dr. Johnson", "status": "Scheduled", "mode": "Video"},
    # ... 10+ more with varied dates, doctors, statuses
]
```

**Endpoints**:
| Method | Route | Purpose |
|--------|-------|---------|
| GET | `/appointments` | List all (with optional `?date=&status=` filters) |
| POST | `/appointments` | Create new (validate, generate ID, check conflicts) |
| PATCH | `/appointments/{id}/status` | Update status |
| DELETE | `/appointments/{id}` | Remove appointment |

**Key Logic**:

1. **Conflict Detection**:
   - Check if same doctor has appointment on same date with overlapping time window
   - Time overlap: `new_start < existing_end AND new_end > existing_start`
   - Reject creation if conflict found

2. **Validation**:
   - Required fields: `patientName`, `date`, `time`, `duration`, `doctorName`, `mode`
   - Return 400 error with message if missing

3. **Defaults**:
   - Auto-generate UUID for `id`
   - Set `status` to `"Scheduled"` if not provided

4. **Status Enum**: `Confirmed`, `Scheduled`, `Cancelled`

---

## Phase 2: Frontend (React + Tailwind)

### File: `frontend/src/EMR_Frontend__Assignment.jsx`

**State Management**:
```javascript
const [appointments, setAppointments] = useState([])
const [selectedDate, setSelectedDate] = useState(null)
const [activeTab, setActiveTab] = useState('today') // today | upcoming | past
const [showCreateForm, setShowCreateForm] = useState(false)
```

**Features**:

1. **Initial Load**:
   ```javascript
   useEffect(() => {
     fetch('http://localhost:8000/appointments')
       .then(res => res.json())
       .then(data => setAppointments(data))
   }, [])
   ```

2. **Calendar Widget**:
   - Display month calendar with clickable dates
   - On click: set `selectedDate`, refetch with `?date=YYYY-MM-DD` filter
   - Highlight dates with appointments

3. **Tab Filtering**:
   - **Today**: `date === today`
   - **Upcoming**: `date > today`
   - **Past**: `date < today`
   - Filter the displayed appointments based on active tab

4. **Appointment Cards**:
   - Show: patient name, time, duration, doctor, status badge, mode
   - Status badge colors: Confirmed (green), Scheduled (blue), Cancelled (red)

5. **Status Update**:
   - Dropdown or buttons to change status
   - On change: `PATCH /appointments/{id}/status` → refetch list

6. **Create Appointment Form**:
   - Modal or slide-out drawer
   - Fields: patientName, date, time, duration, doctorName, mode
   - On submit: `POST /appointments` → close form → refetch list
   - Show error if conflict detected

7. **Delete** (optional):
   - Delete button on each card
   - Confirm dialog → `DELETE /appointments/{id}` → refetch

---

## Phase 3: Documentation

### README.md

**Sections to include**:

1. **Setup Instructions**:
   ```bash
   # Backend
   cd backend
   pip install -r requirements.txt
   uvicorn appointment_service:app --reload

   # Frontend
   cd frontend
   npm install
   npm run dev
   ```

2. **GraphQL Shape** (conceptual - what it would look like):
   ```graphql
   type Appointment {
     id: ID!
     patientName: String!
     date: String!
     time: String!
     duration: Int!
     doctorName: String!
     status: AppointmentStatus!
     mode: String!
   }

   enum AppointmentStatus {
     Confirmed
     Scheduled
     Cancelled
   }

   type Query {
     getAppointments(date: String, status: AppointmentStatus): [Appointment]
   }

   type Mutation {
     createAppointment(input: AppointmentInput!): Appointment
     updateAppointmentStatus(id: ID!, status: AppointmentStatus!): Appointment
     deleteAppointment(id: ID!): Boolean
   }
   ```

3. **Data Consistency Approach**:
   - **Transactions**: In production, use database transactions for create/update/delete
   - **Unique Constraints**: Enforce unique `id` at database level
   - **Conflict Prevention**: Check for time overlap before insert
   - **Idempotency**: Use client-generated request IDs for retries
   - **Optimistic Locking**: Use version field to prevent lost updates

---

## Task Checklist

### Backend
- [ ] Create `backend/` folder structure
- [ ] Set up FastAPI app with CORS middleware
- [ ] Seed 10+ mock appointments with varied data
- [ ] Implement `GET /appointments` with date/status query params
- [ ] Implement `POST /appointments` with validation + conflict check
- [ ] Implement `PATCH /appointments/{id}/status`
- [ ] Implement `DELETE /appointments/{id}`
- [ ] Test endpoints with curl/Postman

### Frontend
- [ ] Create React app with Vite + Tailwind
- [ ] Build AppointmentCard component
- [ ] Build AppointmentList component
- [ ] Build Calendar widget with date selection
- [ ] Implement tab filtering (Today/Upcoming/Past)
- [ ] Implement status update functionality
- [ ] Build CreateAppointmentForm modal
- [ ] Wire all components to backend API
- [ ] Add loading states and error handling
- [ ] Style with Tailwind (match reference images)

### Documentation & Deployment
- [ ] Write README with setup instructions
- [ ] Add GraphQL shape explanation
- [ ] Add data consistency notes
- [ ] Deploy backend (Railway/Render)
- [ ] Deploy frontend (Vercel/Netlify)
- [ ] Test live deployment

---

## Design Decisions

| Decision | Rationale |
|----------|-----------|
| FastAPI over Flask | Built-in async, automatic OpenAPI docs, type hints |
| Refetch after mutations | Simpler than optimistic updates; ensures consistency |
| Status as string enum | Flexible, clear, matches GraphQL pattern |
| Date as ISO string | Consistent format, easy to compare and filter |
| CORS enabled | Required for frontend on different port to call backend |

---

## Risks & Mitigations

| Risk | Mitigation |
|------|------------|
| Time conflict logic bugs | Write unit tests for edge cases (adjacent times, exact overlap) |
| CORS issues | Configure FastAPI CORS middleware with correct origins |
| Date timezone issues | Use date strings (YYYY-MM-DD), not timestamps; compare as strings |
| Large data set performance | Not applicable for mock data; note pagination for production |

---

## Reference UI Notes (from images)

**Reference 1 - Dashboard**:
- Appointment metrics cards at top
- Today's appointments list with time/patient/status
- Active doctors panel on right

**Reference 2 - Calendar View**:
- Calendar on left side
- Time-based appointment blocks in center
- "New Event" form on right with doctor dropdown

**Styling hints**:
- Clean, medical/professional color scheme
- Status badges with distinct colors
- Card-based layout for appointments
- Clear visual hierarchy

---

## Estimated Effort

| Phase | Time |
|-------|------|
| Backend setup + endpoints | 2-3 hours |
| Frontend components | 3-4 hours |
| Styling + polish | 2 hours |
| Documentation + deploy | 1-2 hours |
| **Total** | **8-11 hours** |
